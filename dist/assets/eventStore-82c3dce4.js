import{aA as P,aB as E,ar as W,aj as X,aC as f,ac as i,x as y}from"./index-b45d696c.js";import{o as Z,c as k}from"./operationRepository-f71a1956.js";class T{constructor(t){this.presences=t}}class ee{constructor(t){this.name=t}}var se=Object.defineProperty,te=Object.getOwnPropertyDescriptor,ne=(e,t,a,r)=>{for(var n=r>1?void 0:r?te(t,a):t,c=e.length-1,l;c>=0;c--)(l=e[c])&&(n=(r?l(t,a,n):l(n))||n);return r&&n&&se(t,a,n),n},oe=(e,t)=>(a,r)=>t(a,r,e);let h=class{constructor(e){this.apiService=e}async delete(e){await this.apiService.delete("event/"+e)}async getEvents(e){return console.log(e),e!==""?(await this.apiService.invoke("event?name="+e)).data:(await this.apiService.invoke("event")).data}async getById(e){return(await this.apiService.invoke("event/"+e)).data}async create(e){await this.apiService.post("event/",e)}async update(e){await this.apiService.put("event/"+e.id,e)}async finish(e,t){await this.apiService.put("event/"+e+"/conclusion",t)}};h=ne([P(),oe(0,E("ApiService"))],h);var ae=Object.defineProperty,ie=Object.getOwnPropertyDescriptor,re=(e,t,a,r)=>{for(var n=r>1?void 0:r?ie(t,a):t,c=e.length-1,l;c>=0;c--)(l=e[c])&&(n=(r?l(t,a,n):l(n))||n);return r&&n&&ae(t,a,n),n},ce=(e,t)=>(a,r)=>t(a,r,e);let m=class{constructor(e){this.apiService=e}async getById(e){return(await this.apiService.invoke("event-presence?eventId="+e+"&currentPage=1&pageSize=15")).data}async create(e,t){await this.apiService.post("event-presence/",{eventId:e,volunteerId:t})}async delete(e){await this.apiService.delete("event-presence/"+e)}};m=re([P(),ce(0,E("ApiService"))],m);const he=W("events",()=>{const e=X({isLoading:!0,showModel:!1,showModelRemove:!1,filters:new ee(""),events:[],places:["Hospital Fêmina","Hospital Criança Conceição","Hospital Conceição (Adulto)","Hospital São Pedro","SPAAN","Asilo Padre Cacique","FASE Padre Cacique","FASE Cruzeiro","Vila Safira","Outros"],event:null,initialEvent:null,isEditing:!1,numberConfirmed:0,isOtherSelecteced:!1,volunteersPresent:[],volunteersDeleted:[],action:"D",isTimeEnded:!1,confirmLabel:"",nextMonth:"",shouldShowButton:!0,volunteersConfirmed:new T([])}),t=f.resolve(h),a=f.resolve(m),r=f.resolve(Z),n=i(()=>e.events.length),c=i(()=>e.events),l=i(()=>e.event),M=i(()=>e.isLoading),L=i(()=>e.isEditing),C=i(()=>e.places),D=i(()=>e.numberConfirmed),O=i(()=>e.isOtherSelecteced),R=i(()=>e.showModel),b=i(()=>e.showModelRemove),_=i(()=>e.isTimeEnded),A=i(()=>e.confirmLabel),x=i(()=>e.nextMonth),B=i(()=>e.filters),I=i(()=>e.volunteersPresent),j=i(()=>e.shouldShowButton),V=async()=>{e.isLoading=!0;const s=await t.getEvents("");e.events=s.result,e.isLoading=!1},g=async s=>{const o=y();e.isLoading=!0,e.isEditing=!1,e.showModel=!1;const u=await t.getById(s),p=await a.getById(s);e.volunteersPresent=[],e.action="D",p.result.forEach(d=>e.volunteersPresent.push({presenceId:d.id,attented:!0,id:d.volunteer.id,name:d.volunteer.name,photo:d.volunteer.photo!=null?d.eventPresenceVolunteer.photo:""})),e.event=u,e.initialEvent=u,e.numberConfirmed=e.volunteersPresent.length,console.log(e.volunteersPresent.find(d=>d.id==o.user.id)),e.shouldShowButton=e.volunteersPresent.find(d=>d.id==o.user.id)==null,(await t.getEvents("")).result.forEach(q),e.isLoading=!1};function q(s){if(!e.places.includes(s.name)){const o=e.places.indexOf("Outros");e.places.splice(o,1),e.places.push(s.name),e.places.push("Outros")}}const F=async()=>{e.isLoading=!0;const s=await t.getEvents(e.filters.name);e.events=s.result,e.isLoading=!1},H=async()=>{e.isEditing=!0},N=async()=>{e.action==="D"?(e.isEditing=!1,await g(e.event.id),e.event.name!=="Outros"&&(e.isOtherSelecteced=!1)):history.go(-1)},S=async()=>{e.isLoading=!0;var s=e.event;e.action==="D"?await t.update({id:s==null?void 0:s.id,name:s==null?void 0:s.name,description:s==null?void 0:s.description,address:s==null?void 0:s.address,city:s==null?void 0:s.city,meetingPoint:s==null?void 0:s.meetingPoint,occupancy:s==null?void 0:s.occupancy,happenAt:s==null?void 0:s.happenAt,status:1}):await t.create({name:s==null?void 0:s.name,description:s==null?void 0:s.description,address:s==null?void 0:s.address,city:s==null?void 0:s.city,meetingPoint:s==null?void 0:s.meetingPoint,occupancy:s==null?void 0:s.occupancy,happenAt:s==null?void 0:s.happenAt,status:1}),e.isLoading=!1},$=async()=>{e.isLoading=!0,e.showModel=!1,e.showModelRemove=!1;const s=y();await a.create(e.event.id,s.user.id),e.isLoading=!1},z=async()=>{e.isLoading=!0,e.volunteersPresent.forEach(s=>{s.attented&&e.volunteersConfirmed.presences.push(s.id)}),e.volunteersConfirmed.presences.length>0&&await t.finish(e.event.id,e.volunteersConfirmed),e.showModel=!1,e.showModelRemove=!1,e.isLoading=!1},Y=s=>{e.isOtherSelecteced=s,s&&(e.event.name="")},G=()=>{e.event={id:""},e.isLoading=!1,e.isEditing=!0,e.action="C"},J=s=>{const o=e.volunteersPresent.indexOf(s);e.volunteersDeleted.push(e.volunteersPresent[o]),e.volunteersPresent.splice(o,1),console.log(e.volunteersDeleted),e.numberConfirmed=e.numberConfirmed-1},K=async()=>{e.isLoading=!0,e.volunteersDeleted.forEach(s=>{a.delete(s.presenceId)}),e.isLoading=!1},Q=s=>{const o=e.volunteersPresent.indexOf(s);e.volunteersPresent[o].attented=!e.volunteersPresent[o].attented,console.log(e.volunteersPresent)};let v=5;const U=s=>{e.showModel=s,e.showModelRemove=s,e.isTimeEnded=!s,e.confirmLabel="Confirmar (5)",v=5,w();let o=new Date;var u=new Date(o.setMonth(o.getMonth()+2));e.nextMonth=u.getMonth()+"/"+u.getFullYear()};function w(){v>0?setTimeout(()=>{v-=1,e.confirmLabel="Confirmar ("+v+")",w()},1e3):(e.isTimeEnded=!0,e.confirmLabel="Confirmar")}return{getData:V,eventLength:n,getList:c,isLoading:M,filter:F,filters:B,getEvent:l,getById:g,getPlaces:C,isEditing:L,getNumberConfirmed:D,edit:H,cancel:N,removeVolunteer:J,isOtherSelecteced:O,selectOther:Y,save:S,changeVolunteer:Q,finish:z,CreateNewEvent:G,showModel:R,showModelRemove:b,openModalRemove:async s=>{e.event=s,e.showModelRemove=!0},openModal:U,isTimeEnded:_,confirmLabel:A,confirmVacancy:$,saveVonlunteers:K,shouldShowButton:j,nextMonth:x,volunteersPresent:I,runProcess:async()=>{e.showModel=!0,e.isLoading=!0;let s=new Date;var o=new Date(s.setMonth(s.getMonth()+2)),u=new k(o);await r.createEvents(u);const p=await t.getEvents("");e.events=p.result,e.showModel=!1,e.showModelRemove=!1,e.isLoading=!1},remove:async s=>{e.isLoading=!0,await t.delete(s.id);const o=await t.getEvents(e.filters.name);e.events=o.result,e.showModelRemove=!1}}});export{he as u};
